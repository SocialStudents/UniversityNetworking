<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">

    <ui:composition template="../layout/adminReportLayout.xhtml">
        <ui:define name="content">
            <div id="content">           
                <f:metadata>
                    <f:event listener="#{userServiceBean.setDefaultDateRange()}" type="preRenderView" />
                </f:metadata>
                <h:form prependId="false">
                    <script type="text/javascript">
                        if("#{userRightsDataBean.haveUserReportsRights}" == "false") {                          
                            location.href ="#{loginDataBean.lendingPage}";
                        } 
                        var data = [];
                        var noResult = []
                        noResult.push({
                            label:"No results found",
                            value:""
                        });
                
                        $(document).ready(function() {
                                   
                
                            function split( val ) {
                                return val.split( /,\s*/ );
                            }
                            function extractLast( term ) {
                                return split( term ).pop();
                            }   
                            function onSubmitId(){
                                document.getElementById("uid").value=globalUid;
                            }
                            $("#list").autocomplete({
                                source: data,
                                select: function( event, ui ) {
                                    if(ui.item.label != 'No results found'){
                                        document.getElementById("list").value=ui.item.label;
                                        document.getElementById("uid").value=ui.item.value;
                                        globalUid = ui.item.value;
                                        document.getElementById("dateRange").style.display = "block";
                                    }
                                    if(ui.item.label == 'No results found'){
                                        document.getElementById("list").value="";
                                    }
                                    return false;
                                    
                                },focus: function (event, ui) {
                                    this.value = ui.item.label;
                                    event.preventDefault(); // Prevent the default focus behavior.
                                },source: function(req, responseFn) {
                                    document.getElementById("uid").value="";
                                    var re = $.ui.autocomplete.escapeRegex(req.term);
                                    var matcher = new RegExp(re, "i" );
                                    var a = $.grep( data, function(item,index){
                                        return matcher.test(item.label);
                                    });
                                    if (!a.length) {
                                        re = $.ui.autocomplete.escapeRegex("N");
                                        matcher = new RegExp( "^" + re, "i" );
                                        a = $.grep( noResult, function(item,index){
                                            return matcher.test(item.label);
                                        });
                                    }
                                    responseFn( a );
                                }
                            });
                
                        });
                    </script>
                    <h:inputHidden id="uid" value="#{systemResultViewUtil.id}"/>

                    <ui:include src="../common/message.xhtml" /> 
                    <div id="search-panel" class="userinfo">
                        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable">
                            <tr>
                                <th width="20%">
                                    <h:outputLabel rendered="#{systemResultSessionUtil.prevView == null}">
                                        Looking for PB Specialist
                                    </h:outputLabel>
                                </th>
                                <td>
                                    <div id="search-box-bg">
                                        <h:inputText id="list" styleClass="search-txt-box" rendered="#{systemResultSessionUtil.prevView == null}"/>
                                    </div>
                                </td>                                   
                            </tr>
                        </table>
                        <div id="dateRange" style="display: none">
                            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable1">
                                <th width="20%"><h:outputText value="Range From"/></th>
                                <td>
                                    <h:inputText id="subscriptionFromDate" styleClass="medium" value="#{systemResultViewUtil.subscriptionFromDate}" required="true" requiredMessage="Enter from date">
                                        <f:convertDateTime type="date" dateStyle="MM/dd/yyyy" pattern="MM/dd/yyyy"  timeZone="#{systemPropertyUtil.serverTimeZone}"/>
                                    </h:inputText>
                                    <rich:message for="subscriptionFromDate" />
                                </td>
                                <th><h:outputText value="To"/>
                                </th>
                                <td>
                                    <h:inputText id="subscriptionToDate" styleClass="medium" value="#{systemResultViewUtil.subscriptionToDate}" required="true" requiredMessage="Enter To date">
                                        <f:convertDateTime type="date" dateStyle="MM/dd/yyyy" pattern="MM/dd/yyyy"  timeZone="#{systemPropertyUtil.serverTimeZone}"/>
                                    </h:inputText>
                                    <rich:message for="subscriptionToDate" />
                                </td>
                                <td width="20%">
                                    <a4j:commandButton id="go" value="Search"  action="#{userServiceBean.retrievPbSpecialistInfo()}" 
                                                       onclick="loadWaitPanel('content');" oncomplete="stopWaitPanel('content');document.getElementById('pbSpecialistInfo').style.display = 'block'" 
                                                       render="pbSpecialistdetail"
                                                       styleClass="standard-button" execute="uid,subscriptionFromDate,subscriptionToDate">
                                    </a4j:commandButton>
                                </td>
                            </table>
                        </div>
                    </div>
                    <br/>
                    <div class="content">

                        <a4j:outputPanel id="downloadLink" style="display: none">
                            <h:commandLink action="#{reportToPdfServiceBean.pbSpecialistPerformanceiReport()}" >
                                <h:graphicImage value="/images/download-pdf.jpg" style="border: none; float: right" title="Click to Download Report"/>
                                &nbsp;&nbsp;&nbsp;
                            </h:commandLink>
                            <br></br>
                        </a4j:outputPanel>
                        <div style="display: none" id="pbSpecialistInfo">
                            <a4j:outputPanel id="pbSpecialistdetail">
                                <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable1">
                                    <tr>
                                        <td colspan="4" >
                                            <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">PB Specialist Detail</font>
                                            <hr class="red"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th width="20%">
                                            <h:outputText value="Name"/>
                                        </th>
                                        <td width="30%">
                                            <h:outputText value="#{userDataBean.firstName} #{userDataBean.lastName}"/>
                                        </td>
                                        <th width="20%">
                                            <h:outputText value="Date of joining"/>
                                        </th>
                                        <td width="30%">
                                            <h:outputText value="#{userDataBean.createdOn}">
                                                <f:convertDateTime type="date" pattern="MM/dd/yyyy" timeZone="#{systemPropertyUtil.serverTimeZone}"/>
                                            </h:outputText>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            <h:outputText value="Days attended"/>
                                        </th>
                                        <td>
                                            <h:outputText value="#{userDataBean.totalUnits}"/>
                                        </td>
                                        <th>
                                            <h:outputText value="Sessions conducted"/>
                                        </th>
                                        <td>
                                            <h:outputText value="#{userDataBean.sessions}">
                                            </h:outputText>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th valign="top">
                                            <h:outputText value="New registered PBers"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.count}"/>
                                        </td>
                                        <th valign="top">
                                            <h:outputText value="No. of PBers by renewal"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.renewalCount}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th valign="top">
                                            <h:outputText value="Amount collected from new registrations"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.newRegisteredFees}" rendered="#{userDataBean.newRegisteredFees != null}">
                                                <f:convertNumber minIntegerDigits="1" minFractionDigits="2"/>
                                            </h:outputText>
                                            <h:outputText value="0.0" rendered="#{userDataBean.newRegisteredFees == null}">
                                            </h:outputText>
                                        </td>
                                        <th valign="top">
                                            <h:outputText value="Amount collected from renewals"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.renewalFees}" rendered="#{userDataBean.renewalFees != null}">
                                                <f:convertNumber minIntegerDigits="1" minFractionDigits="2"/>
                                            </h:outputText>
                                            <h:outputText value="0.0" rendered="#{userDataBean.renewalFees == null}">
                                            </h:outputText>
                                        </td>

                                    </tr>
                                    <tr>
                                        <th valign="top">
                                            <h:outputText value="Units earned from new registration"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.commisionNew}" rendered="#{userDataBean.commisionNew != null}">
                                            </h:outputText>
                                            <h:outputText value="N/A" rendered="#{userDataBean.commisionNew == null}">
                                            </h:outputText>
                                        </td>
                                        <th valign="top">
                                            <h:outputText value="Units earned from renewal"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.commisionRenew}" rendered="#{userDataBean.commisionRenew != null}">
                                            </h:outputText>
                                            <h:outputText value="N/A" rendered="#{userDataBean.commisionRenew == null}">
                                            </h:outputText>
                                        </td>

                                    </tr>
                                     <tr>
                                        <th valign="top">
                                            <h:outputText value="Commission amount from new registration"/>
                                        </th>
                                         <td valign="top">
                                             <h:outputText value="#{userDataBean.commissionNewAmount}">
                                            </h:outputText>
                                        </td>
                                        <th valign="top">
                                            <h:outputText value="Commission amount from renewal"/>
                                        </th>
                                        <td valign="top">
                                            <h:outputText value="#{userDataBean.commissionRenewalAmount}">
                                            </h:outputText>
                                        </td>

                                    </tr>
                                    <tr>
                                        <th>
                                            <h:outputText value="Select PBer"/>
                                        </th>
                                        <td>
                                            <h:selectOneMenu styleClass="medium" id="memberList" onchange="loadWaitPanel('content');document.getElementById('memberId').value = this.value;document.getElementById('memberclick').click();" >
                                                <f:selectItem itemLabel="-- Select PBer --" />
                                                <f:selectItems value="#{systemResultViewUtil.memberBasicDetailDataBeanList}" />
                                            </h:selectOneMenu>
                                            <h:inputHidden id="memberId" value="#{systemResultViewUtil.slotId}"  required="true" requiredMessage="Select PBer"/>
                                        </td>
                                    </tr>
                                    <a4j:commandButton id="memberclick" value="Go" action="#{userServiceBean.retrievPbSpecialistInfo()}" render="memberDetail" style="display: none" oncomplete="if(document.getElementById('memberId').value != ''){document.getElementById('memberDetail').style.display = 'block'};document.getElementById('downloadLink').style.display = 'block';stopWaitPanel('content');"/>
                                </table>

                                <h:outputLabel id="memberDetail" style="display: none">
                                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable1">
                                        <tr>
                                            <td colspan="4">
                                                <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">General Detail</font>
                                                <hr class="red"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th width="20%">
                                                <h:outputText value="PBer Name"/>
                                            </th>
                                            <td width="30%">
                                                <h:outputText value="#{userDataBean.address}"/>
                                            </td>
                                            <th width="20%">
                                                <h:outputText value="Goal"/>
                                            </th>
                                            <td width="30%">
                                                <h:outputText value="Lose Weight" rendered="#{userDataBean.address2 eq 'LW'}"/>
                                                <h:outputText value="Increase Stamina" rendered="#{userDataBean.address2 eq 'IS'}"/>
                                                <h:outputText value="Build Muscle" rendered="#{userDataBean.address2 eq 'BM'}"/>
                                                <h:outputText value="Lose Body Fat" rendered="#{userDataBean.address2 eq 'LBF'}"/>
                                            </td>
                                        </tr>                                    
                                    </table>
                                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable1">
                                        <tr>
                                            <td colspan="4" >
                                                <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">Session Detail</font>
                                                <hr class="red"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th width="20%">
                                                <h:outputText value="Attended Sessions"/>
                                            </th>
                                            <td width="30%">
                                                <h:outputText value="#{userDataBean.memberAttended}"/>
                                            </td>
                                            <th width="20%">
                                                <h:outputText value="Cancelled Session"/>
                                            </th>
                                            <td width="30%">
                                                <h:outputText value="#{userDataBean.memberCancelled}">
                                                </h:outputText>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>
                                                <h:outputText value="Booked Sessions"/>
                                            </th>
                                            <td>
                                                <h:outputText value="#{userDataBean.memberScheduled}"/>
                                            </td>
                                            <th>
                                                <h:outputText value="Skipped Session"/>
                                            </th>
                                            <td>
                                                <h:outputText value="#{userDataBean.memberSkipped}">
                                                </h:outputText>
                                            </td>
                                        </tr>
                                    </table>
                                    <h:outputLabel rendered="#{systemResultViewUtil.flag}">
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="form-table" id="listTable1">
                                            <tr>
                                                <td colspan="4" >
                                                    <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">Travel/Vacation Detail</font>
                                                    <hr class="red"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th width="20%">
                                                    <h:outputText value="Travel Starts from "/>

                                                </th>
                                                <td width="30%">
                                                    <h:outputText value="#{memberTravelDetailDataBean.fromDate}">
                                                        <f:convertDateTime pattern="MM/dd/yyyy" />
                                                    </h:outputText>
                                                </td>
                                                <th width="20%">
                                                    <h:outputText value="To"/>
                                                </th>
                                                <td width="30%">
                                                    <h:outputText value="#{memberTravelDetailDataBean.toDate}">
                                                        <f:convertDateTime pattern="MM/dd/yyyy" />
                                                    </h:outputText>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>
                                                    <h:outputText value="Description"/>
                                                </th>
                                                <td>
                                                    <h:outputText value="#{memberTravelDetailDataBean.description}"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </h:outputLabel>
                                    <table class="form-table" cellpadding="0" cellspacing="0" border="0" width="100%">
                                        <tr>
                                            <td colspan="15" >
                                                <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">Measurement Detail</font>
                                                <hr class="red"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="header" width="11%">
                                                Date
                                            </th>
                                            <th class="header" width="7%">
                                                BF%
                                            </th>
                                            <th class="header" width="5%">
                                                Wt.
                                            </th>
                                            <th class="header" colspan="5" style="text-align: center">
                                                Tape (inches)
                                            </th>
                                            <th class="header" colspan="5" style="text-align: center">
                                                Calipers (mm)
                                            </th>
                                        </tr>
                                        <tr>
                                            <th class="header" colspan="3">
                                            </th>
                                            <th class="header" width="8%">
                                                Arm
                                            </th>
                                            <th class="header" width="8%">
                                                Waist
                                            </th>
                                            <th class="header" width="8%">
                                                Hip
                                            </th>
                                            <th class="header" width="8%">
                                                Thigh
                                            </th>
                                            <th class="header" width="8%">
                                                Calf
                                            </th>
                                            <th class="header" width="8%">
                                                Bis
                                            </th>
                                            <th class="header" width="8%">
                                                Tris
                                            </th>
                                            <th class="header" width="8%">
                                                Hip
                                            </th>
                                            <th class="header" width="8%">
                                                Back
                                            </th>
                                            <th class="header" width="8%">
                                                Total
                                            </th>
                                        </tr>
                                    </table>   
                                    <rich:dataTable id="measurementList" value="#{systemResultViewUtil.measurementDetailList}" var="measurementData" style="border: none; width: 100%" rowKeyVar="rowId">
                                        <rich:column>
                                            <table class="form-table" cellpadding="0" cellspacing="0" border="0" width="100%">                                        
                                                <tr>
                                                    <td width="11%">
                                                        <h:outputLabel value="#{measurementData.onDate}">
                                                            <f:convertDateTime pattern="MM/dd/yyyy" type="date" />
                                                        </h:outputLabel>
                                                    </td>
                                                    <td width="7%">
                                                        <h:outputText value="N/A" rendered="#{measurementData.totalBf == null}"/>
                                                        <h:outputText value="#{measurementData.totalBf}" rendered="#{measurementData.totalBf != null}"/>              
                                                    </td>
                                                    <td width="5%">
                                                        #{measurementData.weight}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.tapeArm}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.tapeWaist}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.tapeHip}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.tapeThigh}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.tapeCalf}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.callipersBiceps}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.callipersTriceps}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.callipersHip}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.callipersBack}
                                                    </td>
                                                    <td width="8%">
                                                        #{measurementData.total}
                                                    </td>
                                                </tr>
                                            </table>
                                        </rich:column>
                                    </rich:dataTable>
                                    <h:outputLabel rendered="#{systemResultViewUtil.healthDetailList != null}">
                                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="form-table" align="center">
                                            <tr>
                                                <td colspan="4" >
                                                    <font color="#C11B1D" style="font-size: 15px;font-weight: bold;">Health Detail</font>
                                                    <hr class="red"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </h:outputLabel>
                                    <rich:dataTable id="healthDetailDataList" value="#{systemResultViewUtil.healthDetailList}" var="healthData" style="border: none; width: 100%" rowKeyVar="rowId" rendered="#{systemResultViewUtil.healthDetailList != null}">

                                        <rich:column>

                                            <f:facet name="header">
                                                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="form-table" align="center">
                                                    <thead>
                                                        <th width="25%" class="header">Medical Condition</th>
                                                        <th width="25%" class="header">Intensity</th>
                                                        <th width="25%" class="header">Status</th>
                                                        <th width="25%" class="header">Last updated on</th>
                                                    </thead>                                                       
                                                </table>
                                            </f:facet>
                                            <table class="form-table" cellpadding="0" cellspacing="0" border="0" width="100%">
                                                <tr>
                                                    <td width="25%">
                                                        <h:outputLabel value="#{healthData.injuryName}" />
                                                    </td>
                                                    <td width="25%">
                                                        <h:outputLabel value="#{healthData.intensity}" />
                                                    </td>
                                                    <td width="25%">
                                                        <h:outputLabel value="#{healthData.status}" />
                                                    </td>
                                                    <td width="25%">
                                                        <h:outputText style="width: 100%" value="#{healthData.lastModifiedDate}">
                                                            <f:convertDateTime type="date" pattern="MM/dd/yyyy" />
                                                        </h:outputText>

                                                    </td>
                                                </tr>
                                            </table>
                                        </rich:column>
                                    </rich:dataTable>
                                </h:outputLabel>
                            </a4j:outputPanel>
                        </div>
                    </div>
                </h:form>
            </div>

            <ui:repeat value="#{userServiceBean.pbList}" var="result">
                <script type="text/javascript">
                    data.push({
                        label:"#{result.label}",
                        value:"#{result.value}"
                    }
                );
                
                
               
                </script>
            </ui:repeat>
            <script type="text/javascript">
                getDatePickerForRangeForFuture('subscriptionFromDate','subscriptionToDate');
            </script>
        </ui:define>
    </ui:composition>
</html>

