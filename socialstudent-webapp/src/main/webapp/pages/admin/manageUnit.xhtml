<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">
    <h:body>
        <ui:composition template="../layout/adminLayout.xhtml">
            <ui:define name="content">
                <script type="text/javascript">
                    if(document.getElementById("manageUnit") != null) {
                        document.getElementById("manageUnit").setAttribute("class", "active");
                    } else {
                        location.href ="#{loginDataBean.lendingPage}";
                    }                    
                </script>
                <f:event listener="#{userServiceBean.retrieveUnitPrice()}" type="preRenderComponent" />
                <h:form prependId="false">
                    <h3>Manage Unit</h3>
                    <hr class="red"/>
                    <div class="content">
                        <div id="search-panel"> 
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tbody>
                                    <tr>
                                        <td width="40%"> 
                                            <a4j:commandLink title="Create Unit" oncomplete="#{rich:component('addUnit')}.show();" action="#{userServiceBean.clearDataForUnit()}" render="addUnitPanel"> 
                                                <img src="#{facesContext.externalContext.requestContextPath}/images/new-button.jpg"/>
                                            </a4j:commandLink> &#160;
                                        </td>
                                        <td width="60%" style="vertical-align: middle;text-align: right">
                                            <h:selectBooleanCheckbox value="#{systemResultViewUtil.isShowInActiveData}" >
                                                <a4j:ajax listener="#{userServiceBean.retrieveUnitPrice()}" render="unitsPanel" onbegin="loadWaitPanel('content');" oncomplete="stopWaitPanel('content');"/>
                                            </h:selectBooleanCheckbox>
                                            <strong>Show All</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>                   

                        <a4j:outputPanel id="unitsPanel">         
                            <ui:include src="../common/message.xhtml" /> 

                            <rich:dataTable  id="unitList" rowKeyVar="rowId" rows="10" rendered="#{systemResultViewUtil.unitPriceDataBeanList!=null and not empty systemResultViewUtil.unitPriceDataBeanList}"
                                             var="unitPrice" value="#{systemResultViewUtil.unitPriceDataBeanList}" styleClass="meal-plan" style="width: 100%" rowClass="#{rowId%2 == 0 ? 'alt-row1':'alt-row'}" >
                                <f:facet name="header">
                                    <rich:columnGroup>
                                        <rich:column style="width: 20%" styleClass="header">
                                            <h:outputText value="Amount"/>
                                        </rich:column>
                                        <rich:column style="width: 36%" styleClass="header">
                                            <h:outputText value="Description"/>
                                        </rich:column>                                        
                                        <rich:column style="width: 13%"  styleClass="header">
                                            <h:outputText value="Updated On" />
                                        </rich:column>
                                        <rich:column style="width: 7%; text-align: center;"  styleClass="header">
                                            <h:outputText value="Status" />
                                        </rich:column>
                                    </rich:columnGroup>
                                </f:facet>                              
                                <rich:column style="vertical-align: top">
                                    <h:outputText value="#{unitPrice.amount}">
                                        <f:convertNumber currencySymbol="$" maxFractionDigits="2" minFractionDigits="2" minIntegerDigits="2" groupingUsed="false"/>
                                    </h:outputText>                                    
                                </rich:column>           
                                <rich:column style="vertical-align: top">
                                    <h:outputText value="#{unitPrice.description}">
                                    </h:outputText>  
                                </rich:column>
                                <rich:column style="vertical-align: top">
                                    <h:outputText value="#{unitPrice.createdOn}">
                                        <f:convertDateTime type="date" pattern="MM/dd/yyyy" timeZone="#{systemPropertyUtil.serverTimeZone}"/>
                                    </h:outputText>                                    
                                </rich:column>
                                <rich:column style="text-align: center;vertical-align: top">                                    
                                    <h:graphicImage value="#{unitPrice.status ?'/images/activate.png' :'/images/deactivate.png'}" style="border: none;" title="#{unitPrice.status ?'active' :'Inactive'}"/>
                                </rich:column>                               
                                <f:facet name="footer" >                                    
                                    <div align="center" style="width: 100%;">
                                        <rich:dataScroller for="unitList" renderIfSinglePage="true" maxPages="10" fastStep="5"></rich:dataScroller>  
                                    </div>                                    
                                </f:facet>
                            </rich:dataTable>
                        </a4j:outputPanel>
                    </div>
                </h:form>
                <rich:popupPanel id="addUnit" minHeight="220" width="450" autosized="true">
                    <div id="addUnitContent">
                        <h:form prependId="false">
                            <a4j:outputPanel id="addUnitPanel">
                                <script>
                                    $('#unit').numeric({allow:'.'});
                                </script>
                                <h6> Add Unit
                                    <h:outputLink value="manageUnit" style="float: right" onclick="#{rich:component('addUnit')}.hide();">
                                        <img src="#{facesContext.externalContext.requestContextPath}/images/close-btn.jpg" alt="close" title="Close" align="texttop"/>
                                    </h:outputLink></h6><hr class="red"/>
                                <a4j:outputPanel id="innerDataM">
                                    <h:outputLabel rendered="#{not messageDataBean.isSuccess and messageDataBean.message != null}">
                                        <div class="ui-widget">
                                            <div class="ui-state-error ui-corner-all" style="padding:0px 5px; margin-bottom:10px; font-weight:bold; line-height:16px; "> 
                                                <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
                                                    #{messageDataBean.message}</p><div class="clearing"></div>
                                            </div>                
                                        </div>
                                    </h:outputLabel>
                                </a4j:outputPanel>
                                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="form-table" >
                                    <tr>
                                        <td width="30%"></td>
                                        <td width="55%"></td>
                                        <td width="15%"></td>
                                    </tr> 
                                    <tr>
                                        <th>1 Unit<sup><font color="red">*</font></sup></th>
                                        <td colspan="2">
                                            <h:inputText id="unit" value="#{unitPriceDataBean.amount}"  styleClass="medium" maxlength="7" required="true" requiredMessage="Enter Amount" validatorMessage="Invalid Amount">
                                                <f:ajax event="blur" render="unitMsg" />
                                                <f:validateDoubleRange minimum="1" maximum="10000" />
                                            </h:inputText>&#160; USD

                                        </td>
                                    </tr>
                                    <tr>
                                        <th></th>
                                        <td colspan="2"><rich:message for="unit" id="unitMsg"/></td>
                                    </tr>
                                    <tr>
                                        <th valign="top">
                                            Description
                                        </th>
                                        <td colspan="2"><h:inputTextarea id="iDescription" onfocus="counterForTextArea('iDescription','iDescriptionCounter',255)" onkeyup="counterForTextArea('iDescription','iDescriptionCounter',255)" style="vertical-align: top"  value="#{unitPriceDataBean.description}"  styleClass="medium"/>
                                            <div style="text-align:left" ><i><h:outputText value="(You can type" style="color: grey"/> &#160;<h:outputText id="iDescriptionCounter"  value="255" style="color: grey;"/> &#160;<h:outputText value="more characters)" style="color: grey;"/></i></div>
                                        </td>

                                    </tr>

                                </table>
                                <hr class="red"/>
                                <div align="center" style="width: 100%;">
                                    <a4j:commandButton value="Submit" action="#{userServiceBean.createUnitPrice()}" styleClass="standard-button" render="unitsPanel,dataMessage,addUnitPanel" oncomplete="if(#{messageDataBean.isSuccess != null and messageDataBean.isSuccess}) {#{rich:component('addUnit')}.hide();};stopWaitPanel('addUnitContent');" onbegin="loadWaitPanel('addUnitContent');" />
                                </div>
                            </a4j:outputPanel>
                        </h:form>
                    </div>
                </rich:popupPanel>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
